name: CI - Verificar secretos Supabase
on:
  workflow_dispatch: {}
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Reporte de secretos requeridos
        shell: bash
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          SUPABASE_DATABASE_URL: ${{ secrets.SUPABASE_DATABASE_URL }}
        run: |
          set -euo pipefail
          missing=0
          check() {
            local name="$1"
            local val="${!name:-}"
            if [ -n "$val" ]; then
              echo "$name: [SET]"
            else
              echo "$name: [MISSING]"
              missing=1
            fi
          }
          echo "Verificando secretos de Supabase (no se imprimen valores)…"
          check SUPABASE_URL
          check SUPABASE_ANON_KEY
          check SUPABASE_SERVICE_ROLE_KEY
          check SUPABASE_DATABASE_URL
          if [ "$missing" -ne 0 ]; then
            echo "::error::Faltan secretos marcados como [MISSING]. Agregalos en Settings → Secrets and variables → Actions."
            exit 1
          fi
          echo "Todos los secretos requeridos están presentes."
