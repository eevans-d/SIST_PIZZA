name: CI - Verificar secretos Supabase

on:
  workflow_dispatch:
  push:
    paths:
      - '.github/workflows/check-supabase-secrets.yml'

permissions:
  contents: read

jobs:
  check:
    runs-on: ubuntu-latest
    env:
      SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
      SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
      SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
      SUPABASE_DATABASE_URL: ${{ secrets.SUPABASE_DATABASE_URL }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Reporte de presencia de secretos
        run: |
          echo "== Verificación de secretos Supabase =="
          for key in SUPABASE_URL SUPABASE_ANON_KEY SUPABASE_SERVICE_ROLE_KEY SUPABASE_DATABASE_URL; do
            if [ -n "${!key}" ]; then
              echo "[SET] $key"
            else
              echo "[MISSING] $key"; MISSING=1
            fi
          done
          if [ "$MISSING" = "1" ]; then
            echo "Faltan secretos. Ir a Settings → Secrets and variables → Actions para agregarlos" 1>&2
            exit 1
          fi
          echo "Todos los secretos presentes."
