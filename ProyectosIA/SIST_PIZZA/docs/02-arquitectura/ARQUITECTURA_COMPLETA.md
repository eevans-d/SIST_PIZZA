โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                              โ
โ              ๐๏ธ  ARQUITECTURA COMPLETA - OPCIรN D - DOCUMENTADA             โ
โ                                                                              โ
โ                          SIST_PIZZA - Sistema de Pizzerรญa                   โ
โ                                                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ VISIรN GENERAL DE ARQUITECTURA
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

FLUJO COMPLETO DE UN PEDIDO:

โโโโโโโโโโโโโโโ
โ   WhatsApp  โ
โ   Cliente   โ
โโโโโโโโฌโโโโโโโ
       โ (Mensaje natural)
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ WAHA                โ (WhatsApp HTTP API)
โ (Recibe mensajes)   โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ (Webhook)
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ N8N                                  โ
โ โข Parse mensaje con Claude AI        โ
โ โข Extrae: cliente, items, notas      โ
โ โข Valida datos                       โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
       โ (POST /api/webhooks/n8n/pedido)
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ BACKEND (Node.js/Express)            โ
โ โข Validaciรณn Zod                     โ
โ โข Busca/crea cliente                 โ
โ โข Lookup productos (fuzzy match)     โ
โ โข Calcula costo envรญo dinรกmico       โ
โ โข Inserta en BD                      โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
       โ (INSERT)
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ PostgreSQL (Supabase)                โ
โ โข pedidos                            โ
โ โข comandas (line items)              โ
โ โข pagos                              โ
โ โข audit_logs                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

SISTEMAS AUXILIARES:

โโโโโโโโโโโโโโโโโโโโโโโโ
โ Chatwoot             โ โ Integraciรณn futura (soporte)
โ (Support tickets)    โ
โโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโ
โ Redis                โ โ Cache (future)
โ (Distributed cache)  โ
โโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ API ENDPOINTS ACTUALES
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

DOCUMENTACIรN COMPLETA DE ENDPOINTS:

โโ HEALTHCHECKS โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                            โ
โ 1๏ธโฃ  GET /health                                                          โ
โ    Propรณsito: Health check mรญnimo                                         โ
โ    Respuesta: { status, timestamp, uptime }                              โ
โ    Cรณdigo HTTP: 200 OK                                                    โ
โ    Descripciรณn: Ping simple, sin verificaciรณn de BD                      โ
โ    Uso: Load balancers, monitoring                                        โ
โ    Ejemplo:                                                               โ
โ      curl http://localhost:4000/health | jq .                           โ
โ      {                                                                    โ
โ        "status": "ok",                                                    โ
โ        "timestamp": "2025-10-22T10:30:45.123Z",                         โ
โ        "uptime": 3600                                                     โ
โ      }                                                                    โ
โ                                                                            โ
โ 2๏ธโฃ  GET /api/health                                                      โ
โ    Propรณsito: Health check completo (incluye BD)                         โ
โ    Respuesta: { status, database, integrations, ... }                    โ
โ    Cรณdigo HTTP: 200 OK (BD ok) | 503 Service Unavailable (BD error)    โ
โ    Descripciรณn: Verifica Supabase, integraciones, etc                   โ
โ    Uso: Monitoring avanzado, CI/CD                                       โ
โ    Ejemplo:                                                               โ
โ      curl http://localhost:4000/api/health | jq .                       โ
โ      {                                                                    โ
โ        "status": "ok",                                                    โ
โ        "database": "ok",                                                  โ
โ        "integrations": {                                                  โ
โ          "supabase": true,                                                โ
โ          "claude": false,                                                 โ
โ          "modo": false,                                                   โ
โ          "chatwoot": false                                                โ
โ        }                                                                  โ
โ      }                                                                    โ
โ                                                                            โ
โ 3๏ธโฃ  GET /api/health/ready                                                โ
โ    Propรณsito: Verificar que el sistema estรก ready para recibir pedidos  โ
โ    Respuesta: { ready: bool, timestamp }                                โ
โ    Cรณdigo HTTP: 200 OK (listo) | 503 Service Unavailable (no listo)    โ
โ    Descripciรณn: Comprueba que Supabase estรก disponible                  โ
โ    Uso: Deployment checks, pre-test validation                           โ
โ    Ejemplo:                                                               โ
โ      curl http://localhost:4000/api/health/ready | jq .                โ
โ      { "ready": true, "timestamp": "2025-10-22T10:30:45.123Z" }        โ
โ                                                                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ WEBHOOK N8N โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                            โ
โ 4๏ธโฃ  POST /api/webhooks/n8n/pedido                                        โ
โ    Propรณsito: Recibir pedidos procesados por N8N + Claude                โ
โ    Mรฉtodo: POST                                                           โ
โ    Content-Type: application/json                                         โ
โ    Cรณdigo HTTP: 201 Created | 400 Bad Request | 500 Internal Error      โ
โ                                                                            โ
โ    REQUEST BODY:                                                          โ
โ    {                                                                      โ
โ      "cliente": {                                                         โ
โ        "nombre": "string (requerido)",                                    โ
โ        "telefono": "string (requerido, UNIQUE)",                         โ
โ        "direccion": "string (requerido)"                                 โ
โ      },                                                                   โ
โ      "items": [                                                           โ
โ        {                                                                  โ
โ          "nombre": "string (producto, bรบsqueda fuzzy)",                  โ
โ          "cantidad": "number (> 0)"                                      โ
โ        }                                                                  โ
โ      ],                                                                   โ
โ      "notas": "string (opcional)",                                       โ
โ      "origen": "string (opcional, default: 'whatsapp')"                  โ
โ    }                                                                      โ
โ                                                                            โ
โ    RESPUESTA EXITOSA (201 Created):                                      โ
โ    {                                                                      โ
โ      "success": true,                                                     โ
โ      "pedido": {                                                          โ
โ        "id": 123,                                                         โ
โ        "cliente_id": 1,                                                   โ
โ        "estado": "pendiente",                                             โ
โ        "tipo_entrega": "delivery",                                        โ
โ        "direccion_entrega": "Calle 123",                                 โ
โ        "total": 1800,  โ subtotal + envรญo                               โ
โ        "created_at": "2025-10-22T10:30:45Z"                             โ
โ      },                                                                   โ
โ      "detalle": [                                                         โ
โ        {                                                                  โ
โ          "producto": "Pizza Clรกsica",                                     โ
โ          "cantidad": 2,                                                   โ
โ          "precio_unitario": 800,                                          โ
โ          "subtotal": 1600                                                 โ
โ        }                                                                  โ
โ      ],                                                                   โ
โ      "envio": {                                                           โ
โ        "zona": "Zona Norte",                                              โ
โ        "costo": 200                                                       โ
โ      }                                                                    โ
โ    }                                                                      โ
โ                                                                            โ
โ    ERRORES:                                                               โ
โ    {                                                                      โ
โ      "error": "VALIDATION_ERROR",                                         โ
โ      "message": "Item 'Pizza Especial' no encontrado o no disponible",   โ
โ      "details": [...] (en development mode)                              โ
โ    }                                                                      โ
โ                                                                            โ
โ    VALIDACIONES:                                                          โ
โ    โข cliente.telefono: string, 10-20 caracteres, UNIQUE en BD           โ
โ    โข items: array no vacรญo                                                โ
โ    โข items[].nombre: se busca en menu_items con ILIKE fuzzy match       โ
โ    โข items[].cantidad: number > 0                                        โ
โ    โข direccion: usada para calcular costo de envรญo                       โ
โ                                                                            โ
โ    LรGICA DE NEGOCIO:                                                    โ
โ    1. Valida payload con Zod schema                                      โ
โ    2. Busca cliente por telefono (UNIQUE)                                โ
โ    3. Si no existe โ crea nuevo cliente                                  โ
โ    4. Para cada item โ busca en menu_items (fuzzy ILIKE)                โ
โ    5. Si no encuentra โ error especรญfico                                 โ
โ    6. Calcula subtotal (sum de precios * cantidades)                     โ
โ    7. Busca zona por direcciรณn (fuzzy en palabras_clave)                โ
โ    8. Calcula costo_envio segรบn zona (default $500)                      โ
โ    9. total = subtotal + costo_envio                                     โ
โ   10. Inserta en pedidos, comandas, audit_logs (transaction)            โ
โ   11. Retorna 201 con pedido completo                                    โ
โ                                                                            โ
โ    EJEMPLO CURL:                                                          โ
โ    curl -X POST http://localhost:4000/api/webhooks/n8n/pedido \         โ
โ      -H "Content-Type: application/json" \                               โ
โ      -d '{                                                                โ
โ        "cliente": {                                                       โ
โ          "nombre": "Juan Pรฉrez",                                          โ
โ          "telefono": "+54901234567",                                      โ
โ          "direccion": "Zona Norte, Barrio A"                             โ
โ        },                                                                 โ
โ        "items": [                                                         โ
โ          {"nombre": "pizza clรกsica", "cantidad": 2},                      โ
โ          {"nombre": "coca cola", "cantidad": 1}                           โ
โ        ],                                                                 โ
โ        "notas": "Sin cebolla en la pizza"                                โ
โ      }' | jq .                                                            โ
โ                                                                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ WEBHOOKS FUTUROS (COMENTADOS) โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                            โ
โ 5๏ธโฃ  POST /api/webhooks/chatwoot                                          โ
โ    STATUS: โณ PLANNED                                                     โ
โ    Propรณsito: Integraciรณn con Chatwoot para soporte                      โ
โ    Descripciรณn: Recibir eventos de tickets y actualizar en BD            โ
โ                                                                            โ
โ 6๏ธโฃ  POST /api/webhooks/mercadopago                                       โ
โ    STATUS: โณ PLANNED                                                     โ
โ    Propรณsito: Confirmaciรณn de pagos MercadoPago                          โ
โ    Descripciรณn: Actualizar estado de pago cuando se confirma             โ
โ                                                                            โ
โ 7๏ธโฃ  POST /api/webhooks/whatsapp/status                                   โ
โ    STATUS: โณ PLANNED                                                     โ
โ    Propรณsito: Actualizar estado de mensajes WhatsApp                     โ
โ    Descripciรณn: Confirmar entrega, lectura, etc.                         โ
โ                                                                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ฆ SCHEMAS (ZOD) Y TIPOS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

PedidoN8NSchema (Validaciรณn de entrada webhook):
โโ cliente (object)
โ  โโ nombre (string, 1-100 chars)
โ  โโ telefono (string, 10-20 chars, UNIQUE)
โ  โโ direccion (string, 10-500 chars)
โโ items (array, min 1)
โ  โโ [0+]
โ     โโ nombre (string, 1-100 chars)
โ     โโ cantidad (number, > 0, <= 1000)
โโ notas (string, optional, 0-500 chars)
โโ origen (string, optional, default='whatsapp')

Respuestas HTTP:
โโ 201 Created: Pedido creado exitosamente
โโ 400 Bad Request: Validaciรณn fallida (Zod error)
โโ 409 Conflict: Cliente bloqueado o item deshabilitado
โโ 500 Internal Error: Error de BD o sistema
โโ 503 Service Unavailable: Supabase no disponible

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ SEGURIDAD Y AUTENTICACIรN
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Estrategia Actual:
โโ CORS: Restrictivo (lista blanca de dominios)
โโ HEADERS: Helmet.js (HSTS, X-Frame-Options, etc.)
โโ RATE LIMITING: โณ Planeado
โโ AUTHENTICATION: Pรบblica (webhooks de N8N confiable)
โโ ENCRYPTION: โ HTTPS en producciรณn (requiere SSL cert)

PII REDACTION (Ley 25.326 - GDPR):
โโ Logs: Telรฉfono mascarado (xxxxx7890)
โโ Respuestas: No se expone detalles internos en 500 errors
โโ Auditorรญa: Todos los cambios logged sin PII

VALIDACIรN DE ENTRADA:
โโ Zod schemas en todos los endpoints
โโ Sanitizaciรณn de strings (trim, max length)
โโ Validaciรณn de tipos y formatos
โโ Rechazo de datos invรกlidos (400 Bad Request)

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐๏ธ MODELO DE DATOS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Tablas en PostgreSQL (Supabase):

โโ clientes โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ id (PK)          | BIGINT PRIMARY KEY AUTO_INCREMENT                    โ
โ nombre           | VARCHAR(100) NOT NULL                                โ
โ telefono         | VARCHAR(20) UNIQUE NOT NULL                          โ
โ direccion        | TEXT NOT NULL                                         โ
โ email            | VARCHAR(100)                                         โ
โ notas            | TEXT                                                  โ
โ created_at       | TIMESTAMP DEFAULT NOW()                              โ
โ updated_at       | TIMESTAMP DEFAULT NOW()                              โ
โ รndices:         | UNIQUE (telefono)                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ menu_items โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ id (PK)          | BIGINT PRIMARY KEY AUTO_INCREMENT                    โ
โ nombre           | VARCHAR(100) UNIQUE NOT NULL                         โ
โ categoria        | VARCHAR(50) NOT NULL                                 โ
โ precio           | DECIMAL(10,2) NOT NULL                               โ
โ disponible       | BOOLEAN DEFAULT true                                 โ
โ descripcion      | TEXT                                                  โ
โ created_at       | TIMESTAMP DEFAULT NOW()                              โ
โ รndices:         | UNIQUE (nombre)                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ pedidos โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ id (PK)          | BIGINT PRIMARY KEY AUTO_INCREMENT                    โ
โ cliente_id (FK)  | BIGINT NOT NULL โ clientes.id                        โ
โ estado           | VARCHAR(50) CHECK ('pendiente','preparando',...) โ
โ tipo_entrega     | VARCHAR(50) CHECK ('delivery','retiro')              โ
โ direccion_entrega| TEXT NOT NULL                                        โ
โ total            | DECIMAL(10,2) NOT NULL                               โ
โ notas_cliente    | TEXT                                                  โ
โ created_at       | TIMESTAMP DEFAULT NOW()                              โ
โ updated_at       | TIMESTAMP DEFAULT NOW()                              โ
โ รndices:         | FK (cliente_id), (estado)                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ comandas โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ id (PK)          | BIGINT PRIMARY KEY AUTO_INCREMENT                    โ
โ pedido_id (FK)   | BIGINT NOT NULL โ pedidos.id                         โ
โ menu_item_id (FK)| BIGINT NOT NULL โ menu_items.id                      โ
โ cantidad         | INTEGER NOT NULL                                      โ
โ precio_unitario  | DECIMAL(10,2) NOT NULL                               โ
โ subtotal         | DECIMAL(10,2) NOT NULL                               โ
โ created_at       | TIMESTAMP DEFAULT NOW()                              โ
โ รndices:         | FK (pedido_id), FK (menu_item_id)                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ pagos โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ id (PK)          | BIGINT PRIMARY KEY AUTO_INCREMENT                    โ
โ pedido_id (FK)   | BIGINT NOT NULL โ pedidos.id                         โ
โ metodo_pago      | VARCHAR(50) CHECK ('efectivo','tarjeta',...)     โ
โ monto            | DECIMAL(10,2) NOT NULL                               โ
โ estado           | VARCHAR(50) CHECK ('pendiente','confirmado',...)  โ
โ referencia_externa| VARCHAR(255)                                        โ
โ created_at       | TIMESTAMP DEFAULT NOW()                              โ
โ รndices:         | FK (pedido_id), (estado)                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ audit_logs โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ id (PK)          | BIGINT PRIMARY KEY AUTO_INCREMENT                    โ
โ table_name       | VARCHAR(100) NOT NULL                                โ
โ operation        | VARCHAR(20) NOT NULL (INSERT, UPDATE, DELETE)       โ
โ new_data         | JSONB NOT NULL                                       โ
โ user_id          | VARCHAR(100)                                         โ
โ timestamp        | TIMESTAMP DEFAULT NOW()                              โ
โ รndices:         | (table_name), (operation), (timestamp)               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโ zonas_entrega โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ id (PK)          | BIGINT PRIMARY KEY AUTO_INCREMENT (NEW)              โ
โ nombre           | VARCHAR(100) UNIQUE NOT NULL                         โ
โ palabras_clave   | VARCHAR(500) NOT NULL                                โ
โ costo_base       | DECIMAL(10,2) NOT NULL DEFAULT 500                   โ
โ descripcion      | TEXT                                                  โ
โ activo           | BOOLEAN DEFAULT true                                 โ
โ created_at       | TIMESTAMP DEFAULT NOW()                              โ
โ updated_at       | TIMESTAMP DEFAULT NOW()                              โ
โ รndices:         | UNIQUE (nombre), (activo)                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐งช VALIDACIรN E2E
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

FLUJO COMPLETO TEST:

1๏ธโฃ  HEALTH CHECK
   GET /api/health/ready
   โ Retorna 200 con { ready: true }
   โ Si BD caรญda: retorna 503

2๏ธโฃ  CREAR PEDIDO HAPPY PATH
   POST /api/webhooks/n8n/pedido
   Input: Cliente nuevo, items vรกlidos
   โ Crea cliente (si no existe)
   โ Busca productos con fuzzy match
   โ Calcula costo dinรกmico por zona
   โ Inserta pedido, comandas, audit_logs
   โ Retorna 201 con datos completos

3๏ธโฃ  REUTILIZAR CLIENTE
   POST /api/webhooks/n8n/pedido
   Input: Cliente existente (mismo telรฉfono)
   โ No crea cliente duplicado
   โ Reutiliza cliente existente
   โ Crea nuevo pedido

4๏ธโฃ  PRODUCTO NO ENCONTRADO
   POST /api/webhooks/n8n/pedido
   Input: Producto invรกlido
   โ Retorna 400 Bad Request
   โ Error claro: "Item 'xyz' no encontrado"

5๏ธโฃ  VALIDACIรN FALLIDA
   POST /api/webhooks/n8n/pedido
   Input: Payload invรกlido
   โ Retorna 400 Bad Request
   โ Detalles de validaciรณn Zod

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ MรTRICAS Y OBSERVABILIDAD
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

LOGGING:
โโ Info: Peticiones exitosas, creaciรณn de recursos
โโ Warn: Intentos fallidos, datos incompletos
โโ Error: Errores BD, crashes, excepciones
โโ Debug: (development only) Detalles de operaciones

MรTRICAS A IMPLEMENTAR:
โโ Latencia de requests (percentiles: p50, p95, p99)
โโ Tasa de error (% de 4xx, 5xx)
โโ Tamaรฑo de payload (min, max, promedio)
โโ BD query times
โโ Cache hit/miss rates (cuando se implemente Redis)

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ DEPLOYMENT
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

AMBIENTE: Development
โโ Backend: localhost:4000
โโ BD: Supabase (proyecto htvlwhisjpdagqkqnpxg)
โโ Logs: Console
โโ Health: GET http://localhost:4000/api/health

AMBIENTE: Production (Planificado)
โโ Backend: Node.js en Docker (port 3000 interno)
โโ BD: PostgreSQL en RDS o Supabase producciรณn
โโ Logs: ELK Stack o CloudWatch
โโ Monitoreo: Prometheus + Grafana
โโ Load Balancer: Nginx con SSL
โโ CI/CD: GitHub Actions

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ RESUMEN
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ Endpoints actuales: 3 healthchecks + 1 webhook = 4 rutas
โ Tablas DB: 7 (6 + nueva zonas_entrega)
โ Validaciรณn: Zod schemas en todos los endpoints
โ Seguridad: CORS, Helmet, PII redaction, error handling
โ Logging: Estructurado, sin datos sensibles
โ E2E Validaciรณn: Completa (happy path + error cases)
โ Documentaciรณn: Completa (este archivo)

SIGUIENTE: OpenAPI 3.0 Specification (API_ENDPOINTS.md)

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
