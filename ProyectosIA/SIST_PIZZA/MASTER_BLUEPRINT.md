โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                              โ
โ                    ๐ฏ SIST_PIZZA - MASTER BLUEPRINT                         โ
โ                                                                              โ
โ                   SISTEMA UNIFICADO DE RUMBOS, INSTRUCCIONES,               โ
โ                     ARQUITECTURA Y CHECKLIST EJECUTABLE                      โ
โ                                                                              โ
โ                          Versiรณn 3.0 - Unificada                            โ
โ                                                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ TABLA DE CONTENIDOS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

1. RESUMEN EJECUTIVO
2. ARQUITECTURA UNIFICADA
3. RUTAS DE EJECUCIรN (3 OPCIONES)
4. BLUEPRINT PASO-A-PASO
5. CHECKLIST ACCIONABLE
6. DECISIONES ARQUITECTรNICAS
7. FLUJOS E2E
8. TROUBLESHOOTING CENTRALIZADO

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
1๏ธโฃ  RESUMEN EJECUTIVO
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ PROYECTO: Sistema de gestiรณn de pedidos para pizzerรญa con integraciรณn WhatsApp
๐ข COMPONENTES:
   โโ Backend: Node.js + TypeScript (4,346+ LOC)
   โโ Database: PostgreSQL 15+ (Supabase: htvlwhisjpdagqkqnpxg)
   โโ API: Express.js + Zod validation
   โโ Tests: Vitest (48 tests: 12 existing + 36 new)
   โโ Integration: WAHA (WhatsApp client) โ N8N (automation) โ Backend
   โโ Deployment: Docker (6 services), Kubernetes ready

โฑ๏ธ  TIEMPOS ESTIMADOS:
   โข Setup SQL: 11 minutos
   โข Tests: 5 minutos (ejecuciรณn)
   โข Docker setup: 4-5 horas
   โข Full deployment: 6-8 horas

๐ฏ ESTADO ACTUAL:
   โ Backend code: 100% (3 TODOs resueltos)
   โ Tests: 100% (48 tests implementados)
   โ Documentaciรณn: 100% (consolidada)
   โณ SQL ejecutado: 0% (USER ACTION - 11 minutos)
   โณ Docker: 0% (OPTIONAL - 4-5 horas)

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
2๏ธโฃ  ARQUITECTURA UNIFICADA
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐๏ธ  DIAGRAMA GENERAL:

WhatsApp Client
      โ
   WAHA Service (WhatsApp HTTP API)
      โ
   N8N Automation Engine
      โ
   Backend Express.js (localhost:4000)
      โโ POST /api/webhooks/n8n/pedido (Main webhook)
      โโ GET /api/health (Full check)
      โโ GET /api/health/ready (DB verification)
      โโ GET /health (Simple check)
      โ
   Supabase PostgreSQL (7 tables)
      โโ clientes
      โโ menu_items
      โโ pedidos
      โโ comandas
      โโ pagos
      โโ audit_logs
      โโ zonas_entrega (dynamic pricing)

๐ TABLAS BASE DE DATOS:

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ clientes                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ id (UUID)          | telefono (UNIQUE) | direccion          โ
โ nombre             | email             | notas              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ menu_items                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ id (UUID)          | nombre (UNIQUE)   | categoria          โ
โ precio (DECIMAL)   | disponible (BOOL) | timestamps         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ pedidos                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ id (UUID)          | cliente_id (FK)   | estado             โ
โ tipo_entrega       | direccion_entrega | total (DECIMAL)    โ
โ notas_cliente      | timestamps        |                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ comandas (Order items)                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ id (UUID)          | pedido_id (FK)    | menu_item_id (FK) โ
โ cantidad (INT)     | precio_unitario   | subtotal          โ
โ timestamps         |                   |                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ pagos                                                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ id (UUID)          | pedido_id (FK)    | metodo_pago        โ
โ monto (DECIMAL)    | estado            | referencia_externa โ
โ timestamps         |                   |                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ audit_logs                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ id (UUID)          | table_name        | operation          โ
โ new_data (JSONB)   | user_id           | timestamps         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ zonas_entrega (Dynamic Shipping)                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ id (UUID)          | nombre            | palabras_clave     โ
โ costo_base (DEC)   | descripcion       | activo (BOOL)      โ
โ timestamps         |                   |                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ SEGURIDAD:
   โข Helmet.js: Headers de seguridad
   โข CORS restrictivo: Trรกfico solo autorizado
   โข Zod validation: Esquemas de entrada
   โข PII redaction: Ley 25.326/GDPR
   โข SQL injection prevention: Prepared statements
   โข RLS: Row Level Security en Supabase
   โข Rate limiting: Ready to implement

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
3๏ธโฃ  RUTAS DE EJECUCIรN (3 OPCIONES)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

RUTA 1: MรNIMA (MVP) - 20 minutos โก
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   1. Ejecutar SQL (11 minutos)
   2. Validar setup (30 segundos)
   3. Iniciar backend (1 minuto)
   4. Probar webhook (5 minutos)
   
   Resultado: Sistema funcional bรกsico

RUTA 2: รGIL - 1.5 horas โ๏ธ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   1. Ejecutar SQL (11 minutos)
   2. Validar setup (1 minuto)
   3. Iniciar backend (1 minuto)
   4. Ejecutar tests (5 minutos)
   5. Revisar E2E flows (15 minutos)
   6. Preparar webhook N8N (30 minutos)
   
   Resultado: Sistema validado y testeado

RUTA 3: COMPLETA - 8-10 horas ๐
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   1. Ejecutar SQL (11 minutos)
   2. Ruta 2 (1.5 horas)
   3. Docker setup (4-5 horas)
      - PostgreSQL container
      - Redis container
      - WAHA container
      - N8N container
      - Chatwoot container
      - Backend container
   4. Kubernetes deploy prep (1-2 horas)
   5. Production validation (30 minutos)
   
   Resultado: Sistema completamente containerizado y listo para producciรณn

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
4๏ธโฃ  BLUEPRINT PASO-A-PASO
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ ETAPA 0: PREPARACIรN PREVIA (5 minutos)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

[ ] 1. Verificar que tienes acceso a Supabase
      โโ URL: https://supabase.com/dashboard
      โโ Project ID: htvlwhisjpdagqkqnpxg

[ ] 2. Verificar que Backend estรก en la carpeta correcta
      โโ Ruta: /home/eevan/ProyectosIA/SIST_PIZZA/backend
      โโ Comando: ls -la backend/src/server.ts

[ ] 3. Verificar que tienes Node.js 18+ instalado
      โโ Comando: node --version
      โโ Esperado: v18.0.0 o superior

[ ] 4. Verificar que npm dependencies estรกn instaladas
      โโ Comando: npm list | head -5
      โโ Ubicaciรณn: /home/eevan/ProyectosIA/SIST_PIZZA/backend

๐ ETAPA 1: EJECUTAR SQL (11 minutos)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

[ ] 1. Abre el archivo: PASO_2_SCHEMA_SQL.txt
      โโ Copia TODO el cรณdigo SQL (excepto instrucciones)

[ ] 2. Ve a Supabase SQL Editor
      โโ URL: https://supabase.com/dashboard/project/htvlwhisjpdagqkqnpxg/sql/new

[ ] 3. Pega el SQL de PASO_2_SCHEMA_SQL.txt
      โโ Click "Run"
      โโ Espera confirmaciรณn: "Success. No rows returned"

[ ] 4. Abre el archivo: PASO_3_SEED_DATA_SQL.txt
      โโ Copia TODO el cรณdigo SQL

[ ] 5. Nuevo query en Supabase
      โโ Pega el SQL de PASO_3_SEED_DATA_SQL.txt
      โโ Click "Run"
      โโ Espera confirmaciรณn: "Success"

[ ] 6. Abre el archivo: CREAR_ZONAS_ENTREGA.sql
      โโ Copia TODO el cรณdigo SQL

[ ] 7. Nuevo query en Supabase
      โโ Pega el SQL
      โโ Click "Run"
      โโ Espera confirmaciรณn: "Success"

[ ] 8. Valida en Table Editor (5 segundos)
      โโ Ve a: https://supabase.com/dashboard/project/htvlwhisjpdagqkqnpxg/editor
      โโ Deberรญas ver 7 tablas con datos

๐ ETAPA 2: VALIDAR SETUP (2 minutos)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

[ ] 1. Terminal: Valida el backend estรก corriendo
      โโ cd /home/eevan/ProyectosIA/SIST_PIZZA/backend
      โโ npm run dev
      โโ Espera: "Server running on localhost:4000"

[ ] 2. Nueva terminal: Health check del backend
      โโ curl http://localhost:4000/api/health | jq .
      โโ Esperado: "database": "ok"

[ ] 3. Nueva terminal: Health check con BD verification
      โโ curl http://localhost:4000/api/health/ready | jq .
      โโ Esperado: "database": "ok" (no debe ser "error")

[ ] 4. Si algo falla, ver TROUBLESHOOTING CENTRALIZADO (secciรณn 8)

๐ ETAPA 3A: EJECUTAR TESTS (5 minutos)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

[ ] 1. Terminal: Ve a directorio backend
      โโ cd /home/eevan/ProyectosIA/SIST_PIZZA/backend

[ ] 2. Ejecuta todos los tests
      โโ npm test
      โโ Esperado: 48 passing (100%)

[ ] 3. Ejecuta con coverage
      โโ npm test -- --coverage
      โโ Esperado: 50.9% lรญneas cubiertas

[ ] 4. Revisa reporte en: coverage/index.html
      โโ Firefox: firefox coverage/index.html
      โโ Chrome: google-chrome coverage/index.html

๐ ETAPA 3B: PROBAR WEBHOOK E2E (10 minutos)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

[ ] 1. Terminal: Verifica que backend sigue corriendo
      โโ curl http://localhost:4000/health
      โโ Esperado: "ok"

[ ] 2. Abre archivo: docs/04-testing/INTEGRACIรN_E2E_TESTING.md
      โโ Hay 8 ejemplos curl listos para copiar-pegar

[ ] 3. Ejemplo bรกsico: Crear un pedido
      โโ curl -X POST http://localhost:4000/api/webhooks/n8n/pedido \
           -H "Content-Type: application/json" \
           -d '{
             "cliente": {
               "nombre": "Test User",
               "telefono": "+541112345678"
             },
             "items": [
               {
                 "nombre": "Pizza Grande Muzzarella",
                 "cantidad": 2,
                 "precio": 500
               }
             ],
             "direccion_entrega": "Calle Principal 123, Centro",
             "tipo_entrega": "domicilio"
           }'

[ ] 4. Validar respuesta
      โโ Debe retornar: 201 Created con pedido_id
      โโ Debe incluir: costo dinรกmico de envรญo por zona

[ ] 5. Revisar en Supabase
      โโ Tabla pedidos: debe tener 1 nuevo pedido
      โโ Tabla comandas: debe tener los items
      โโ Tabla clientes: debe tener el cliente nuevo

๐ ETAPA 4: PREPARAR DOCKER (4-5 horas) - OPCIONAL
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

[ ] 1. Ver documento completo en: docs/05-deployment/RUTA_DOCKER_PLAN.md
      โโ Contiene 6 servicios totalmente especificados

[ ] 2. Requisitos:
      โโ Docker Desktop instalado y corriendo
      โโ 8GB RAM mรญnimo disponible
      โโ 20GB disco libre

[ ] 3. Setup PostgreSQL container
      โโ Ver instrucciones en docker-compose.yml

[ ] 4. Setup Redis container
      โโ Para caching de productos

[ ] 5. Setup WAHA container
      โโ Para integraciรณn WhatsApp

[ ] 6. Setup N8N container
      โโ Para automatizaciรณn de workflows

[ ] 7. Setup Chatwoot container
      โโ Para gestiรณn de conversaciones

[ ] 8. Setup Backend container
      โโ Build con docker build -t sist-pizza-backend .
      โโ Run con docker-compose up

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
5๏ธโฃ  CHECKLIST ACCIONABLE (DESGLรSADO)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ฏ CHECKLIST RรPIDO (MVP - 20 minutos)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โฑ๏ธ  Tiempo total: ~20 minutos

- [ ] ETAPA 0: Verificaciones previas (5 min)
  - [ ] Supabase accesible
  - [ ] Backend en carpeta correcta
  - [ ] Node.js 18+ instalado
  - [ ] npm dependencies instaladas

- [ ] ETAPA 1: Ejecutar SQL (11 min)
  - [ ] PASO_2_SCHEMA_SQL.txt ejecutado
  - [ ] PASO_3_SEED_DATA_SQL.txt ejecutado
  - [ ] CREAR_ZONAS_ENTREGA.sql ejecutado
  - [ ] 7 tablas visibles en Table Editor
  - [ ] 25+ registros verificados

- [ ] ETAPA 2: Validar setup (2 min)
  - [ ] Backend corriendo en localhost:4000
  - [ ] GET /api/health retorna "ok"
  - [ ] GET /api/health/ready retorna "ok"
  - [ ] Database connection verified

- [ ] ETAPA 3A: Tests (5 min)
  - [ ] npm test retorna 48 passing
  - [ ] Coverage >= 50%

โ ESTADO FINAL: Sistema MVP funcional

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ฏ CHECKLIST COMPLETO (รGIL - 1.5 horas)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โฑ๏ธ  Tiempo total: ~90 minutos

[ COMPLETAR TODO LO DE ARRIBA ]

- [ ] ETAPA 3B: Probar webhook E2E (10 min)
  - [ ] Webhook bรกsico funciona
  - [ ] Crear pedido retorna 201
  - [ ] Pedido visible en Supabase
  - [ ] Costo de envรญo por zona aplicado
  - [ ] Comandas creadas correctamente
  - [ ] Audit logs registrados

- [ ] ETAPA 4: Revisar arquitectura (5 min)
  - [ ] Documentaciรณn leรญda
  - [ ] Decisiones arquitectรณnicas comprendidas
  - [ ] E2E flows entendidos

โ ESTADO FINAL: Sistema validado y testeado

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ฏ CHECKLIST PRODUCCIรN (COMPLETA - 8-10 horas)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โฑ๏ธ  Tiempo total: ~8-10 horas

[ COMPLETAR TODO DE ARRIBA ]

- [ ] ETAPA 5: Docker setup (4-5 horas)
  - [ ] docker-compose.yml configurado
  - [ ] Postgres container running
  - [ ] Redis container running
  - [ ] WAHA container running
  - [ ] N8N container running
  - [ ] Chatwoot container running
  - [ ] Backend container running
  - [ ] Health checks en todos los servicios

- [ ] ETAPA 6: Validaciรณn end-to-end (1 hora)
  - [ ] Webhook desde N8N โ Backend funciona
  - [ ] Datos persisten en Supabase
  - [ ] Cache Redis funciona
  - [ ] WhatsApp messages recibidos por WAHA
  - [ ] Auditorรญa completa registrada

- [ ] ETAPA 7: Kubernetes prep (1-2 horas)
  - [ ] Manifests YAML creados
  - [ ] Volumes persistentes configurados
  - [ ] Secrets configurados
  - [ ] ReadinessProbes/LivenessProbes definidos

โ ESTADO FINAL: Sistema production-ready containerizado

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
6๏ธโฃ  DECISIONES ARQUITECTรNICAS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ DECISIรN 1: ยฟPor quรฉ Supabase y no soluciรณn tradicional?
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Pros:
   โข PostgreSQL managed (sin administraciรณn)
   โข RLS nativo (seguridad de datos)
   โข Real-time subscriptions
   โข Backups automรกticos
   โข Escalable horizontalmente

โ Cons:
   โข Costo por uso
   โข Vendor lock-in

๐ก Decisiรณn: Supabase es la soluciรณn correcta para startup/MVP

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ DECISIรN 2: ยฟPor quรฉ Express.js y no Next.js/NestJS?
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Express es mejor porque:
   โข Webhook handler simple y directo
   โข Bajo overhead
   โข Fรกcil de debuggear
   โข Perfect para integraciรณn N8N

โ Next.js/NestJS serรญa overkill para webhook handler

๐ก Decisiรณn: Express es correcto. Si hay escalabilidad, migrar a NestJS despuรฉs

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ DECISIรN 3: ยฟHealth checks simples o reales?
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ANTES: Health check solo retornaba "ok"
โ PROBLEMA: No verificaba BD realmente

โ AHORA (Session 2):
   โข /health: Simple (sin BD)
   โข /api/health: Full check (con integrations)
   โข /api/health/ready: Real BD verification (503 si BD down)

๐ก Decisiรณn: Health checks deben ser reales, no falsos positivos

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ DECISIรN 4: ยฟShipping cost hardcoded o dinรกmico?
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ANTES: Todos los pedidos $500 envรญo (hardcoded)
โ PROBLEMA: No refleja zonas geogrรกficas

โ AHORA (Session 2):
   โข Tabla zonas_entrega con 5 zonas
   โข Pricing: Centro $300, Norte $500, Sur $600, Oeste $700, Este $550
   โข Fuzzy matching por palabras clave en direcciรณn
   โข Fallback dinรกmico si no coincide

๐ก Decisiรณn: Datos deben estar en BD, no hardcodeados

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ DECISIรN 5: ยฟTesting manual o automatizado?
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ANTES: Testing solo manual/webhook
โ PROBLEMA: No hay cobertura de casos edge

โ AHORA (Session 2):
   โข 48 tests totales
   โข 6 categorรญas: health, integration, schemas, logic, errors, security
   โข Coverage 50.9%
   โข Validaciรณn automรกtica de cambios

๐ก Decisiรณn: Tests son mandatorios antes de cualquier cambio

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ DECISIรN 6: ยฟDocumentaciรณn dispersa o centralizada?
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ANTES: 50+ archivos de documentaciรณn duplicados
โ PROBLEMA: Usuario confundido sobre quรฉ leer

โ AHORA (Session 3):
   โข MASTER_BLUEPRINT.md unificado
   โข docs/ organizado en 6 categorรญas
   โข .docs-deprecated/ para archivos legacy
   โข รndice รบnico sin redundancia

๐ก Decisiรณn: Documentaciรณn centralizada en blueprint + รญndice claro

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
7๏ธโฃ  FLUJOS E2E VALIDADOS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ FLUJO 1: Happy Path (Pedido exitoso)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Entrada:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ POST /api/webhooks/n8n/pedido        โ
โ                                     โ
โ {                                   โ
โ   "cliente": {                      โ
โ     "nombre": "Juan",               โ
โ     "telefono": "+54911123456"      โ
โ   },                                โ
โ   "items": [                        โ
โ     {                               โ
โ       "nombre": "Pizza Grande",     โ
โ       "cantidad": 2,                โ
โ       "precio": 500                 โ
โ     }                               โ
โ   ],                                โ
โ   "direccion_entrega":              โ
โ   "Av. Principal 456, Centro",      โ
โ   "tipo_entrega": "domicilio"       โ
โ }                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Proceso:
1. Validaciรณn con Zod โ โ Vรกlido
2. Lookup cliente por telรฉfono โ โ Nuevo o existente
3. Buscar productos โ โ "Pizza Grande" encontrado
4. Query zona por direcciรณn โ โ Coincide "Centro"
5. Costo envรญo: $300 (Centro)
6. Calcular total: (500ร2) + 300 = $1,300
7. Crear pedido, comandas, pagos en transacciรณn
8. Registrar en audit_logs

Salida:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ HTTP 201 Created                    โ
โ                                     โ
โ {                                   โ
โ   "pedido_id": "uuid-xxx",          โ
โ   "total": 1300,                    โ
โ   "costo_envio": 300,               โ
โ   "zona_entrega": "Centro",         โ
โ   "estado": "pendiente_confirmacion"โ
โ }                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Base de datos:
โ clientes: nuevo registro
โ pedidos: 1 nuevo pedido
โ comandas: 2 items (qty ร 2)
โ pagos: 1 registro pendiente
โ audit_logs: 4 operaciones registradas

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ FLUJO 2: Validaciรณn fallida
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Entrada (INVรLIDO):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ POST /api/webhooks/n8n/pedido        โ
โ                                     โ
โ {                                   โ
โ   "cliente": null,                  โ โ Invรกlido
โ   "items": []                       โ โ Vacรญo
โ }                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Salida:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ HTTP 400 Bad Request                โ
โ                                     โ
โ {                                   โ
โ   "error": "Validation failed",     โ
โ   "details": [                      โ
โ     "cliente is required",          โ
โ     "items must not be empty"       โ
โ   ]                                 โ
โ }                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ FLUJO 3: Producto no encontrado
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Entrada:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Items: "Pizza Especial Inexistente" โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Salida:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ HTTP 400 Bad Request                โ
โ                                     โ
โ {                                   โ
โ   "error": "Product not found",     โ
โ   "producto": "Pizza Especial...",  โ
โ   "disponibles": [                  โ
โ     "Pizza Grande Muzzarella",      โ
โ     "Pizza Grande Especial",        โ
โ     ...                             โ
โ   ]                                 โ
โ }                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Base de datos: โ SIN cambios

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ FLUJO 4: Zona desconocida
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Entrada:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ direccion_entrega: "Lugar Remoto"   โ
โ (no coincide con ninguna zona)      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Resultado:
โ Sigue adelante con zona fallback
โโ Costo envรญo: $500 (default)
โโ zona_entrega: "Desconocida"
โโ Total recalculado

Salida:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ HTTP 201 Created (warning)          โ
โ                                     โ
โ {                                   โ
โ   "pedido_id": "uuid-yyy",          โ
โ   "warning": "Zona desconocida",    โ
โ   "costo_envio": 500,               โ
โ   "zona_entrega": "Desconocida"     โ
โ }                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Base de datos: โ Pedido creado

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
8๏ธโฃ  TROUBLESHOOTING CENTRALIZADO
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐จ PROBLEMA: "relation does not exist"
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Sรญntoma:
  Error: relation "clientes" does not exist

Causa probable:
  โข SQL schema no fue ejecutado
  โข Supabase wrong project ID

Soluciรณn:
  1. Verifica que project ID es: htvlwhisjpdagqkqnpxg
  2. Abre PASO_2_SCHEMA_SQL.txt
  3. Copia y ejecuta en Supabase SQL Editor
  4. Verifica en Table Editor que 7 tablas existen

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐จ PROBLEMA: "database": "error" en health check
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Sรญntoma:
  GET /api/health/ready retorna:
  {"status": "ok", "database": "error"}

Causa probable:
  โข Backend no puede conectarse a Supabase
  โข Credenciales .env incorrectas
  โข Supabase proyecto offline

Soluciรณn:
  1. Verifica credenciales en backend/.env
     - SUPABASE_URL debe ser URL del proyecto
     - SUPABASE_ANON_KEY debe ser la key correcta
  
  2. Prueba conexiรณn manual:
     curl -H "Authorization: Bearer YOUR_KEY" \
       https://htvlwhisjpdagqkqnpxg.supabase.co/rest/v1/clientes?limit=1
  
  3. Si falla, reinicia backend:
     pkill -f "npm run dev"
     cd backend && npm run dev

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐จ PROBLEMA: Tests fallan con "ECONNREFUSED"
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Sรญntoma:
  Error: connect ECONNREFUSED 127.0.0.1:5432

Causa probable:
  โข Backend no estรก corriendo
  โข Puerto 4000 no estรก disponible

Soluciรณn:
  1. Verifica que backend corre:
     lsof -i :4000
  
  2. Si no corre, inicia:
     cd /home/eevan/ProyectosIA/SIST_PIZZA/backend
     npm run dev
  
  3. Espera 5 segundos y reintenta tests:
     npm test

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐จ PROBLEMA: Webhook retorna HTTP 400
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Sรญntoma:
  POST /api/webhooks/n8n/pedido retorna 400 Bad Request

Causa probable:
  โข Payload JSON invรกlido
  โข Campos requeridos faltantes
  โข Tipo de dato incorrecto

Soluciรณn:
  1. Abre: docs/04-testing/INTEGRACIรN_E2E_TESTING.md
  2. Copia un ejemplo curl exactamente
  3. Verifica el JSON estรก bien formado
  4. Revisa logs del backend:
     grep "Validation" backend/logs/server.log

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐จ PROBLEMA: "duplicate key value violates unique constraint"
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Sรญntoma:
  Error durante SEED DATA SQL execution

Causa probable:
  โข SEED DATA ya fue ejecutado antes
  โข Datos duplicados en tabla

Soluciรณn:
  โข Esto NO es un error crรญtico
  โข Los datos ya existen en BD
  โข Puedes ignorarlo y continuar

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐จ PROBLEMA: "npm: command not found"
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Sรญntoma:
  command not found: npm

Causa probable:
  โข Node.js no estรก instalado
  โข npm no estรก en PATH

Soluciรณn:
  1. Instala Node.js:
     https://nodejs.org (v18+)
  
  2. Verifica instalaciรณn:
     node --version
     npm --version
  
  3. Reintenta npm command

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REFERENCIAS RรPIDAS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ ESTRUCTURA DE ARCHIVOS ESENCIALES:

/home/eevan/ProyectosIA/SIST_PIZZA/
โโโ docs/
โ   โโโ 01-inicio/
โ   โ   โโโ INDEX.md (lee esto primero)
โ   โ   โโโ QUICK_START.md
โ   โโโ 02-arquitectura/
โ   โ   โโโ ARQUITECTURA_COMPLETA.md
โ   โ   โโโ E2E_FLOWS.md
โ   โ   โโโ openapi.yaml
โ   โโโ 03-setup-sql/
โ   โ   โโโ EJECUTAR_SQL_AHORA.md
โ   โ   โโโ PASO_2_SCHEMA_SQL.txt
โ   โ   โโโ PASO_3_SEED_DATA_SQL.txt
โ   โ   โโโ CREAR_ZONAS_ENTREGA.sql
โ   โโโ 04-testing/
โ   โ   โโโ RUTA_TESTS_PLAN.md
โ   โ   โโโ INTEGRACIรN_E2E_TESTING.md
โ   โ   โโโ test-examples/
โ   โโโ 05-deployment/
โ   โ   โโโ RUTA_DOCKER_PLAN.md
โ   โ   โโโ docker-compose.yml
โ   โ   โโโ Dockerfile
โ   โโโ 06-referencias/
โ       โโโ TROUBLESHOOTING.md
โ
โโโ backend/
โ   โโโ src/
โ   โ   โโโ server.ts (Express app)
โ   โ   โโโ workflows/webhookN8N.ts
โ   โ   โโโ ...
โ   โโโ __tests__/
โ   โ   โโโ health.test.ts
โ   โ   โโโ integration.test.ts
โ   โ   โโโ schemas.test.ts
โ   โ   โโโ business-logic.test.ts
โ   โ   โโโ error-handling.test.ts
โ   โ   โโโ security.test.ts
โ   โโโ package.json
โ
โโโ MASTER_BLUEPRINT.md (โ Tร ESTรS AQUร)
โโโ README.md

๐ COMANDOS PRINCIPALES:

Setup & Validation:
โโ npm install          (instalar dependencias)
โโ npm run dev          (iniciar backend)
โโ npm test             (ejecutar tests)
โโ npm test -- --coverage (con coverage)

Database:
โโ Ver: docs/03-setup-sql/PASO_2_SCHEMA_SQL.txt
โโ Ver: docs/03-setup-sql/PASO_3_SEED_DATA_SQL.txt
โโ Ver: docs/03-setup-sql/CREAR_ZONAS_ENTREGA.sql

Healthchecks:
โโ curl http://localhost:4000/health
โโ curl http://localhost:4000/api/health | jq .
โโ curl http://localhost:4000/api/health/ready | jq .

Testing:
โโ curl -X POST http://localhost:4000/api/webhooks/n8n/pedido \
โ  -H "Content-Type: application/json" \
โ  -d '{"cliente":{"nombre":"Test","telefono":"+541112345678"},...}'
โโ Ver ejemplos en: docs/04-testing/INTEGRACIรN_E2E_TESTING.md

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ESTADO ACTUAL & PRรXIMOS PASOS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ COMPLETADO (100%):
   โโ Backend code (3 TODOs resueltos)
   โโ Tests (48 implementados)
   โโ Documentaciรณn (consolidada)
   โโ Arquitectura (definida)
   โโ Decisiones tรฉcnicas (documentadas)

โณ PENDIENTE (USER ACTION):
   โโ Ejecutar SQL (11 minutos) โ CRรTICO
   โโ Validar setup (2 minutos) โ Importante
   โโ Ejecutar tests (5 minutos) โ Importante
   โโ Docker setup (4-5 horas) โ Opcional

๐ฏ DECISIONES A TOMAR:
   โโ ยฟEjecutar SQL ahora? โ Sร
   โโ ยฟHacer RUTA 1 (MVP)? โ Rรกpido para validar
   โโ ยฟHacer RUTA 2 (รgil)? โ Mรกs completo
   โโ ยฟHacer RUTA 3 (Completa)? โ Full deployment

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

รltima actualizaciรณn: Session 3 - Limpieza y Unificaciรณn
Versiรณn: 3.0 (Master Blueprint)
Estado: ๐ Listo para ejecuciรณn

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
